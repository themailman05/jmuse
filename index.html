<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>PlayIt</title>
    <link href='//fonts.googleapis.com/css?family=Roboto:300,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
</head>
<body>
	<nav class="grey lighten-5" role="navigation">
		<div class="nav-wrapper container">
		<a id="logo-container" href="//educ.jmu.edu/~sargenlt/jmuse/" class="brand-logo">
			<img src="static/img/playIt_logo.png" style="margin-top:6px;" />
		</a>
			<ul class="right">
        		<li style="padding-left:10px;padding-right:10px;cursor:pointer;" id="addBtn"><i class="mdi-content-add light-blue-text" id="addIcon"></i></li>
        		<li style="padding-left:10px;padding-right:10px;cursor:pointer;" id="playBtn"><i class="mdi-av-play-arrow light-blue-text" id="playIcon"></i></li>
        		<li style="padding-left:10px;padding-right:10px;cursor:pointer;" id="clearBtn"><i class="mdi-content-clear light-blue-text" id="clearIcon"></i></li>
      		</ul>
      		<input type="file" name="localFileDiag" id="localFileDiag" style="display:none;" accept="audio/*"/>
		</div>
	</nav>
	<div class="section no-pad-bot" id="index-banner">
		<div class="container">
			<div class="row" style="margin-top:16px;">
				<div class="col s7">
					<h1 class="header orange-text">Playing Gemini</h1>
					<h5 class="header col s12 light">Audio Playback and Visualization Engine</h5>
				</div>
				<div class="col s5" style="margin-top:16px;">
					<h3 class="header orange-text">Playlist</h3>
					<ul class="collapsible" data-collapsible="accordion" id="playlistGUI">

  					</ul>
				</div>
			</div>
			<div class="row">
				<div class="col s12">
					<h5 class="header orange-text">PlayIt Instructions</h5>
					<ol>
						<li>Click the + sign to add a new file to the playlist.  Files are added locally so no files are uploaded to the server.</li>	
						<li>You may add multiple audio files, the files will be added to the playlist above.</li>
						<li>Select the song/audio file that you would like to listen to and use the audio control at in the top right corner to "Play", "Pause", and "Clear" the playlist.</li>
					</ol>
				</div>
			</div>
		</div>
	</div>

	<audio id="player" preload="auto">
		Your browser does not support the audio element.
	</audio>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/js/materialize.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			var items = 0,
			playing = 0,
			playlist = [],
			player = $("#player").get(0),
			playlistGUI = $("#playlistGUI ul"),
			time = new Date(),
			formattedTime = time.getHours() + ":" + time.getMinutes(),
			objectURL,
			fileName,
			fileType,
			fileSize;

			$("#player").on("canplaythrough", function(e){
			    var seconds = e.currentTarget.duration;
			    var duration = moment.duration(seconds, "seconds");
			    
			    var time = "";
			    var hours = duration.hours();
			    if (hours > 0) { time = hours + ":" ; }
			    
			    time = time + duration.minutes() + ":" + duration.seconds();
			    $("#duration").text(time);
			    
			    URL.revokeObjectURL(objectUrl);
			});
			
			$('#addBtn').on('click',function(e){
            	e.preventDefault();
         		$('#localFileDiag').trigger('click');
    		});
		
			$("#playBtn").click(function(){
				if (items == 0)
				{
					alert("Playlist Empty");
				}
				else
				{
					if (player.paused)
					{
						player.src = playlist[playing];
						player.play();
						$("#playIcon").removeClass("mdi-av-play-arrow").addClass("mdi-av-pause");
					}
					else
					{
						player.pause();
						$("#playIcon").removeClass("mdi-av-pause").addClass("mdi-av-play-arrow");
					}
				}
			});
		
			$("#clearBtn").click(function(){
				clearPlaylist();
			});
			
			$('.collapsible').collapsible({
      			accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
    		});
    		
    		$('#localFileDiag').on('change',function(e){
    			var files = this.files;
    			var file = e.currentTarget.files[0];
			   
			    fileName = file.name;
			    fileType = file.type;
			    fileSize = file.size;
			    
			    objectUrl = URL.createObjectURL(file);
			    $("#player").prop("src", objectUrl);
			    
    			addToPlaylist(file);
			});
			
			$('#player').on('ended', function() {
   				playNext();
			});
			
			function addToPlaylist(itemToAdd) {
				var songName = prompt("Song Title:");
				var artist = prompt("Artist:");
				$("#playlistGUI").append('<li><div class="collapsible-header">' + songName + ' - ' + artist + '</div><div class="collapsible-body"><p>Song Title: ' + songName + '<br />Artist: ' + artist + '<br />Added: ' + getTime() + '</p></div></li>');
				updateTotal();
				playlist[items - 1] = itemToAdd;
				
			}
			
			function updateTotal() {
				items++;
			}
			
			function playNext() {
				playing++;
				if (playing == items)
				{
					playing = 0;
				}
				player.src = playlist[playing];
				player.play();
				
			}
			
			function getTime() {
				return formattedTime;
			}
			
			function clearPlaylist() {
				$("#playlistGUI").empty();
				items = 0;
				playing = 0;
				player.pause();
				$("#playIcon").removeClass("mdi-av-pause").addClass("mdi-av-play-arrow");
				player.src = null;
				playlist = [];
			}
        
		});
		
		
	</script>
    <!-- <script src="js/player.js"></script> -->
    
    <!-- <input type="file" style="visibility:hidden;" id="uploadme" /> -->
    <!-- <input type="button" id="clickme" value="Upload mp3!" /> -->
    
   
    
    <!-- <button id ='drumMachine'>Drum Machine GO</button> -->
        <!-- <script type="text/javascript"> -->
            <!-- document.getElementById("drumMachine").addEventListener("click", drumMachine()); -->
        <!-- </script> -->
	</body>
</html>